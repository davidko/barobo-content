/*! LinkbotJS 11-12-2014 */
function RobotStatus(){var a=this;this.robots=[],this.list=function(){return a.robots},this.acquire=function(b){var c=a.robots.filter(function(a){return"ready"===a.status}),d={robots:[],registered:a.robots.length,ready:c.length};return d.ready>=b&&(rs=c.slice(0,b),rs.map(function(a){return a.status="acquired",a.status}),d.robots=rs.map(function(a){return a.linkbot}),d.ready-=b),d},this.add=function(b){return a.robots.map(function(a){return a.id}).indexOf(b)<0?a.robots.push({status:"new",id:b}):!1},this.remove=function(b){var c=a.robots.map(function(a){return a.id}).indexOf(b);return c>=0?a.robots.splice(c,1):!1},this.relinquish=function(b){var c=a.robots.map(function(a){return a.id}).indexOf(b._id);return c>=0&&"acquired"===a.robots[c].status?(a.robots[c].status="ready",a.robots[c].status):!1},this.ready=function(b,c){var d=a.robots[b];null!==d&&(d.linkbot=c,d.status="ready")},this.fail=function(b){var c=a.robots[b];null!==c&&(c.status="failed")}}function RobotManager(a){function b(){A.redraw()}function c(){C.linkbot.moveTo(0,0,0)}function d(){var a=LinkbotControls.slider.getValue("buzzer-frequency-id");C.linkbot.buzzerFrequency(a),setTimeout(function(){C.linkbot.buzzerFrequency(0)},250)}function e(){var a=LinkbotControls.slider.getValue("buzzer-frequency-id");C.linkbot.buzzerFrequency(a)}function f(){C.linkbot.buzzerFrequency(0)}function g(){var a,b;a=LinkbotControls.slider.getValue("speed-joint-1"),b=LinkbotControls.slider.getValue("speed-joint-2"),C.linkbot.angularSpeed(a,0,b)}function h(){var a,b;a=LinkbotControls.knob.getInternalValue("position-joint-1"),b=LinkbotControls.knob.getInternalValue("position-joint-2"),C.linkbot.moveTo(a,0,b)}function i(a,b,c){LinkbotControls.slider.get("accel-xaxis").setValue(c.x),LinkbotControls.slider.get("accel-yaxis").setValue(c.y),LinkbotControls.slider.get("accel-zaxis").setValue(c.z);var d=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);LinkbotControls.slider.get("accel-mag").setValue(d)}function j(b,c){if("failed"!=c.status){var d=a.getElementById("robomgr-control-panel");d.className="";var e=a.getElementById("robomgr-overlay");e.className="";var f=a.getElementById("robomgr-control-panel-linkbot");f.innerText="Linkbot "+c.id,a.getElementById("robomgr-tab-control-panel").className="",a.getElementById("robomgr-tab-sensors-panel").className="robomgr-hide",a.getElementById("robomgr-tab-control").parentElement.className="robomgr-active",a.getElementById("robomgr-tab-sensors").parentElement.className="",a.getElementById("linkbotjs-led-color").value="#"+n(c.linkbot.getColor()),C=c,C.linkbot.angularSpeed(50,0,50),LinkbotControls.slider.get("speed-joint-1").setValue(50),LinkbotControls.slider.get("speed-joint-2").setValue(50),LinkbotControls.slider.get("buzzer-frequency-id").setValue(440),pos=C.linkbot.wheelPositions(),pos&&(LinkbotControls.knob.get("position-joint-1").setValue(pos[0]),LinkbotControls.knob.get("position-joint-2").setValue(pos[3])),C.linkbot.register({accel:{callback:i},wheel:{0:{distance:1,callback:function(a,b,c){LinkbotControls.knob.get("position-joint-1").setValueWithoutChange(c.position)}},2:{distance:1,callback:function(a,b,c){LinkbotControls.knob.get("position-joint-2").setValueWithoutChange(c.position)}}},button:{0:{callback:function(a,b,c){console.log(c)}},1:{callback:function(){console.log(event)}},2:{callback:function(){console.log(event)}}}})}}function k(){var b=a.getElementById("robomgr-control-panel"),c=a.getElementById("robomgr-overlay");b.setAttribute("class","robomgr-hide"),c.setAttribute("class","robomgr-hide"),C.linkbot.unregister(!1),C=null,u()}function l(a){var b;return b="#"===a.substr(0,1)?parseInt(a.substring(1),16):parseInt(a,16),{red:b>>16&255,green:b>>8&255,blue:255&b}}function m(a){if(!a||null===a||"undefined"===a)return"00";var b=Math.round(a);return b=b.toString(16),b.length<2&&(b="0"+b),b}function n(a){var b=m(a.red),c=m(a.green),d=m(a.blue);return b+c+d}function o(a){if(a){var b=a.getAttribute("id");return b&&/^robomgr\-id\-/.test(b)?a:o(a.parentElement)}return null}function p(a){var b=a.target.getAttribute("id");b&&/^robomgr\-id\-/.test(b)&&(a.dataTransfer.setData("text/html",a.target.innerHTML),a.dataTransfer.effectAllowed="move",source=a.target)}function q(a){a.preventDefault&&a.preventDefault(),a.dataTransfer.dropEffect="move"}function r(a){if(a.stopPropagation&&a.stopPropagation(),source!=a.target){var b=o(a.target);if(!b||null===b)return!0;var c=source.getAttribute("id").replace(/robomgr-id-/,""),d=b.getAttribute("id").replace(/robomgr-id-/,""),e=b.parentElement;b==e.lastChild?(e.removeChild(source),e.insertBefore(source,null)):b==source.nextSibling?(e.removeChild(source),e.insertBefore(source,b.nextSibling)):(e.removeChild(source),e.insertBefore(source,b));for(var f=B.moved,g=0;g<f.length;g++)f[g](c,d);return!1}return!0}function s(a){var b;a.preventDefault(),b=A.element.querySelector("input#robotInput"),A.add(b.value),b.value="",A.connect(),A.redraw()}function t(a){var b=A.element.querySelector("span"),c=/robomgr-left/.test(b.className);c&&u(a)}function u(b){var c,d,e,f,g;if(b&&b.preventDefault&&b.preventDefault(),e=A.element.querySelector("span"),c=a.querySelector("#robomgr-container"),d=/robomgr-left/.test(e.className),f=a.getElementById("robomgr-slideout-overlay"),d){var h=a.getElementsByClassName("robomgr-slide-element");for(g=0;g<h.length;g++)h[g].className="robomgr-slide-element robomgr-slide-element-left";e.className="robomgr-pulloutbtn robomgr-right",c.className="robomgr-container-hidden",a.body.style.marginLeft="",f.style.display="none",D=null}else e.className="robomgr-pulloutbtn robomgr-left",c.className="robomgr-container-open",a.body.style.marginLeft="300px",f.style.display="block";return b}function v(b,c){var d,e,f,g;if(e=b.target,/robomgr-slide-element/.test(e.className)){if(f=/robomgr-slide-element-right/.test(e.className))e.className="robomgr-slide-element robomgr-slide-element-left",k();else{for(d=a.getElementsByClassName("robomgr-slide-element"),g=0;g<d.length;g++)d[g].className="robomgr-slide-element robomgr-slide-element-left";e.className="robomgr-slide-element robomgr-slide-element-right",j(b,c)}b.stopPropagation()}}function w(a,b){a.preventDefault(),A.robots.remove(b);for(var c=B.remove,d=0;d<c.length;d++)c[d](b);A.redraw()}function x(a,b){var c=a.createElement("li"),d=a.createElement("div"),e=a.createElement("span");e.setAttribute("class","robomgr-remove-btn"),e.innerText="trash";var f=a.createElement("span");f.setAttribute("class","robomgr-beep-btn"),f.innerText="beep",c.setAttribute("draggable","true"),c.setAttribute("class","robomgr--"+b.status),c.setAttribute("id","robomgr-id-"+b.id),c.style.background=b.linkbot?"#"+n(b.linkbot.getColor()):"#606060",c.appendChild(f),c.appendChild(e),d.setAttribute("class","robomgr-slide-element robomgr-slide-element-left");var g=["",'<span id="robot-id-'+b.id+'-name" class="robomgr-robot-name">Linkbot '+b.id+"</span><br/>",'<span id="robot-id-'+b.id+'-status" class="robomgr-robot-status">'+("failed"==b.status?"offline":b.status)+"</span>"].join("");return d.innerHTML=g,c.appendChild(d),c.addEventListener("dragstart",p),c.addEventListener("dragover",q),c.addEventListener("drop",r),d.addEventListener("click",function(a){v(a,b)},!0),e.addEventListener("click",function(a){w(a,b.id)}),f.addEventListener("click",function(){"failed"!==b.status&&(b.linkbot.buzzerFrequency(500),setTimeout(function(){b.linkbot.buzzerFrequency(0)},250))}),c}function y(a){var b=a.createElement("div");b.setAttribute("id","robomgr-top-navigation");var c=["",'<h1 class="robomgr-logo"><a href="/index.html">Linkbot Labs</a></h1>','<div class="robomgr-top-nav-info">',' <p id="ljs-top-nav-breadcrumbs" class="robomgr-top-nav-breadcrumbs">&nbsp;</p>',' <h1 id="ljs-top-nav-title" class="robomgr-top-nav-title">&nbsp;</h1>',"</div>"].join("");return b.innerHTML=c,b}function z(b){var i,j,m,n,o,p,q;j=b.createElement("div"),p=b.createElement("div"),p.setAttribute("id","robomgr-slideout-overlay"),n=b.createElement("div"),n.setAttribute("id","robomgr-overlay"),n.setAttribute("class","robomgr-hide"),j.setAttribute("class","robomgr-container-hidden"),j.setAttribute("id","robomgr-container");var r=["",'<div class="robomgr-pullout">','  <span class="robomgr-pulloutbtn robomgr-right"></span>',"</div>",'<div id="robomgr-container-content">',"  <form>",'    <div id="robotFormContainer">','      <label for="robotInput" id="robotInputLabel" class="sr-only">Linkbot ID</label>','      <input name="robotInput" id="robotInput" type="text" placeholder="Linkbot ID" />','      <button id="robomgr-add">Add</button>',"    </div>",'  </form><ol id="robomgr-robot-list"></ol>',"</div>"].join("");j.innerHTML=r,i=j.querySelector("button"),o=j.querySelector(".robomgr-pullout"),i.addEventListener("click",s),o.addEventListener("click",u),p.addEventListener("click",t),m=b.createElement("div"),m.setAttribute("class","robomgr-hide"),m.setAttribute("id","robomgr-control-panel");var v=["",'<div class="robomgr-control-nav">',' <div class="robomgr-control-img">close</div>',' <div class="robomgr-control-title">','   <h1 id="robomgr-control-panel-linkbot">Linkbot</h1>',"   <span>control panel</span>"," </div>","</div>","<div>",' <ul class="robomgr-tabs">','   <li class="robomgr-active"><a id="robomgr-tab-control">control</a></li>','   <li><a id="robomgr-tab-sensors">sensors</a></li>'," </ul>","</div>",'<div id="robomgr-tab-control-panel">',' <div class="robomgr-row">','   <div class="robomgr-control-col">position','     <div class="robomgr-control-poster" style="padding: 10px;">','       <div style="float: left;">','         <input type="text" class="linkbotjs-knob" id="position-joint-1" /> <p style="margin:0;">Joint 1</p>',"       </div>",'       <div style="margin-left: 125px; width: 125px;">','         <input type="text" class="linkbotjs-knob" id="position-joint-2" /> <p style="margin:0;">Joint 2</p>',"       </div>","     </div>","   </div>",'   <div class="robomgr-control-col">',"     joint control",'     <div class="robomgr-control-poster">','       <div style="display: inline-table;">','         <button id="robomgr-joint1-up" class="robomgr-btn-up joint-control-btn">joint 1 up</button>','         <button id="robomgr-joint1-stop" class="robomgr-btn-stop joint-control-btn">joint 1 stop</button>','         <button id="robomgr-joint1-down" class="robomgr-btn-down joint-control-btn">joint 1 down</button>',"         joint1","       </div>",'       <div style="display: inline-table;">','         <button id="robomgr-joint2-up" class="robomgr-btn-up joint-control-btn">joint 2 up</button>','         <button id="robomgr-joint2-stop" class="robomgr-btn-stop joint-control-btn">joint 2 stop</button>','         <button id="robomgr-joint2-down" class="robomgr-btn-down joint-control-btn">joint 2 down</button>',"         joint2","       </div>","     </div>","   </div>"," </div>",' <div class="robomgr-row">','   <div class="robomgr-control-col">',"     drive control",'     <div class="robomgr-control-poster">','       <div><button id="robomgr-drive-up" class="drive-control-btn-sm robomgr-btn-up">up</button></div>',"       <div>",'         <button id="robomgr-drive-left" class="drive-control-btn-sm robomgr-btn-left">left</button>','         <button id="robomgr-drive-down" class="drive-control-btn-sm robomgr-btn-down">down</button>','         <button id="robomgr-drive-right" class="drive-control-btn-sm robomgr-btn-right">right</button>',"       </div>",'       <div><button id="robomgr-drive-zero" class="drive-control-btn-lg robomgr-btn-zero">zero</button></div>','       <div><button id="robomgr-drive-stop" class="drive-control-btn-lg robomgr-btn-stop">stop</button></div>',"     </div>","   </div>",'   <div class="robomgr-control-col">speed','     <div class="robomgr-control-poster" style="padding: 10px;">','       <div style="float: left; width: 110px;">','         <div id="speed-joint-1" class="linkbotjs-slider" data-min="10" data-max="200"></div> <p style="padding-top: 10px;">Joint 1: <span id="speed-joint-1-value">10</span></p>',"       </div>",'       <div style="margin-left: 132px; width: 110px;">','         <div id="speed-joint-2" class="linkbotjs-slider" data-min="10" data-max="200"></div> <p style="padding-top: 10px;">Joint 2: <span id="speed-joint-2-value">10</span></p>',"       </div>","     </div>","     acceleration",'     <div class="robomgr-control-poster" style="padding: 10px;">','       <div style="float: left; width: 110px;">','         <div id="acceleration-joint-1" class="linkbotjs-slider" data-min="10" data-max="200"></div> <p style="padding-top: 10px;">Joint 1: <span id="acceleration-joint-1-value">10</span></p>',"       </div>",'       <div style="margin-left: 132px; width: 110px;">','         <div id="acceleration-joint-2" class="linkbotjs-slider" data-min="10" data-max="200"></div> <p style="padding-top: 10px;">Joint 2: <span id="acceleration-joint-2-value">10</span></p>',"       </div>","     </div>","   </div>"," </div>",' <div class="robomgr-row">','   <div class="robomgr-control-col" style="visibility: hidden;"></div>'," </div>","</div>",'<div id="robomgr-tab-sensors-panel" class="robomgr-hide">',' <div class="robomgr-row" style="text-align: center;">buzzer control','     <div class="robomgr-control-poster" style="padding: 10px 30px;">',"     <div>",'       <div style="float: left; width: 300px;">','         <span>buzzer frequency (hz):</span> <span id="buzzer-frequency-id-value">440</span>','         <div id="buzzer-frequency-id" class="linkbotjs-slider" data-min="130" data-max="1000"></div>',"       </div>",'       <div style="width: 100px; margin-left: 305px;">','         <span id="buzzer-frequency-button" class="robomgr-beep-btn">beep</span>',"       </div>","     </div>","   </div>"," </div>",' <div class="robomgr-row" style="text-align: center;">accelerometer','   <div class="robomgr-control-poster" style="height: 275px; padding: 20px;">','     <div style="float: left; width: 140px; height: 100%;"><div id="accel-xaxis" style="height: 90%; margin: 0 auto;" class="linkbotjs-vslider" data-type="float" data-min="-5" data-max="5"></div><p style="padding-top: 10px;">x axis: <span id="accel-xaxis-value">0</span></p></div>','     <div style="float: left; width: 140px; height: 100%;"><div id="accel-yaxis" style="height: 90%; margin: 0 auto;" class="linkbotjs-vslider" data-type="float" data-min="-5" data-max="5"></div><p style="padding-top: 10px;">y axis: <span id="accel-yaxis-value">0</span></p></div>','     <div style="float: left; width: 140px; height: 100%;"><div id="accel-zaxis" style="height: 90%; margin: 0 auto;" class="linkbotjs-vslider" data-type="float" data-min="-5" data-max="5"></div><p style="padding-top: 10px;">z axis: <span id="accel-zaxis-value">0</span></p></div>','     <div style="width: 130px; margin-left: 420px; height: 100%;"><div id="accel-mag" style="height: 90%; margin: 0 auto;" class="linkbotjs-vslider" data-type="float" data-min="0" data-max="5"></div><p style="padding-top: 10px;">mag: <span id="accel-mag-value">0</span></p></div>',"   </div>"," </div>",' <div class="robomgr-row" style="text-align: center;">LED Color','   <div class="robomgr-control-poster" style="padding: 10px 30px;">','     <input type="color" id="linkbotjs-led-color" />',"   </div>"," </div>","</div>"].join("");m.innerHTML=v,j.appendChild(p),j.appendChild(n),j.appendChild(m),n.addEventListener("click",k),m.addEventListener("click",function(a){a.stopPropagation()});var w=m.querySelector("#linkbotjs-led-color");w.addEventListener("input",function(){var a=l(w.value);C.linkbot.color(a.red,a.green,a.blue)});var x=m.getElementsByClassName("robomgr-control-img");x[0].addEventListener("click",function(){k()});var y,z=m.getElementsByClassName("linkbotjs-knob");for(y=0;y<z.length;y++)LinkbotControls.knob.add(z[y]);var A=m.getElementsByClassName("linkbotjs-slider");for(y=0;y<A.length;y++)LinkbotControls.slider.add(A[y]);var B=m.getElementsByClassName("linkbotjs-vslider");for(y=0;y<B.length;y++)LinkbotControls.slider.add(B[y]);LinkbotControls.slider.addChangeCallback("speed-joint-1",function(b){a.getElementById("speed-joint-1-value").innerText=b,g(b)}),LinkbotControls.slider.addChangeCallback("speed-joint-2",function(b){a.getElementById("speed-joint-2-value").innerText=b,g(b)}),LinkbotControls.slider.addChangeCallback("acceleration-joint-1",function(b){a.getElementById("acceleration-joint-1-value").innerText=b}),LinkbotControls.slider.addChangeCallback("acceleration-joint-2",function(b){a.getElementById("acceleration-joint-2-value").innerText=b}),LinkbotControls.slider.addChangeCallback("buzzer-frequency-id",function(b){a.getElementById("buzzer-frequency-id-value").innerText=b}),LinkbotControls.slider.addChangeCallback("accel-xaxis",function(b){a.getElementById("accel-xaxis-value").innerText=Math.round(1e4*b)/1e4}),LinkbotControls.slider.addChangeCallback("accel-yaxis",function(b){a.getElementById("accel-yaxis-value").innerText=Math.round(1e4*b)/1e4}),LinkbotControls.slider.addChangeCallback("accel-zaxis",function(b){a.getElementById("accel-zaxis-value").innerText=Math.round(1e4*b)/1e4}),LinkbotControls.slider.addChangeCallback("accel-mag",function(b){a.getElementById("accel-mag-value").innerText=Math.round(1e4*b)/1e4}),LinkbotControls.knob.addChangeCallback("position-joint-1",h),LinkbotControls.knob.addChangeCallback("position-joint-2",h);var D=m.getElementsByTagName("a");for(y in D)"robomgr-tab-control"==D[y].id?D[y].addEventListener("click",function(b){a.getElementById("robomgr-tab-control-panel").className="",a.getElementById("robomgr-tab-sensors-panel").className="robomgr-hide",a.getElementById("robomgr-tab-control").parentElement.className="robomgr-active",a.getElementById("robomgr-tab-sensors").parentElement.className="",b.stopPropagation()}):"robomgr-tab-sensors"==D[y].id&&D[y].addEventListener("click",function(b){a.getElementById("robomgr-tab-control-panel").className="robomgr-hide",a.getElementById("robomgr-tab-sensors-panel").className="",a.getElementById("robomgr-tab-control").parentElement.className="",a.getElementById("robomgr-tab-sensors").parentElement.className="robomgr-active",b.stopPropagation()});var E=m.getElementsByClassName("robomgr-beep-btn");y=0;for(y in E){var F=E[y];F&&F.addEventListener&&(F.addEventListener("onmousedown",e),F.addEventListener("onmouseup",f),F.addEventListener("click",d))}var G=m.getElementsByTagName("button");for(y in G)q=G[y],q&&q.id&&("robomgr-drive-stop"===q.id?q.addEventListener("click",function(){C.linkbot.stop()}):"robomgr-joint1-stop"==q.id?q.addEventListener("click",function(){C.linkbot.moveJointContinuous(0,0)}):"robomgr-joint2-stop"==q.id?q.addEventListener("click",function(){C.linkbot.moveJointContinuous(2,0)}):"robomgr-drive-zero"==q.id&&q.addEventListener("click",c));var H=m.getElementsByTagName("button");for(y=0;y<H.length;y++)q=H[y],q.id&&("robomgr-drive-up"===q.id?q.addEventListener("click",function(){C.linkbot.moveForward()}):"robomgr-drive-down"===q.id?q.addEventListener("click",function(){C.linkbot.moveBackward()}):"robomgr-drive-left"===q.id?q.addEventListener("click",function(){C.linkbot.moveLeft()}):"robomgr-drive-right"===q.id?q.addEventListener("click",function(){C.linkbot.moveRight()}):"robomgr-joint1-up"===q.id?q.addEventListener("click",function(){C.linkbot.moveJointContinuous(0,1)}):"robomgr-joint1-down"===q.id?q.addEventListener("click",function(){C.linkbot.moveJointContinuous(0,-1)}):"robomgr-joint2-up"===q.id?q.addEventListener("click",function(){C.linkbot.moveJointContinuous(2,-1)}):"robomgr-joint2-down"===q.id&&q.addEventListener("click",function(){C.linkbot.moveJointContinuous(2,1)}));return j}var A=this,B={add:[],remove:[],moved:[]},C=null,D=null;this.robots=new RobotStatus,this.element=z(a),this.topNav=y(a),this.acquire=function(a){var b=A.robots.acquire(a);return A.redraw(),b},this.relinquish=function(a){a.disconnect(),A.robots.relinquish(a),A.redraw()},this.add=function(){var a=1<=arguments.length?[].slice.call(arguments,0):[],b=B.add;a.map(function(a){A.robots.add(a);for(var c=0;c<b.length;c++)b[c](a)})},this.redraw=function(){var a=A.element.ownerDocument,b=a.createElement("ol");b.setAttribute("id","robomgr-robot-list");for(var c=A.robots.list(),d=0;d<c.length;d++){var e=c[d];b.appendChild(x(a,e))}var f=A.element.querySelector("ol#robomgr-robot-list");f.parentElement.replaceChild(b,f)},this.connect=function(){for(var a=A.robots.list(),c=[],d=0;d<a.length;d++){var e=a[d];"new"===e.status?(bot=new Linkbot(e.id),null!==bot._id?(c.push(A.robots.ready(d,bot)),bot.register({led:{callback:b}})):c.push(A.robots.fail(d))):c.push(void 0)}return c},this.registerEvent=function(a,b){var c=B[a];c&&c.push(b)},this.unregisterEvent=function(a,b){var c=B[a];c&&c.pop(b)},this.selectedControlPanelRobot=function(){return C}}function Linkbot(a){function b(a,b,c){return null===c&&(c={}),function(d,e,f,g){return d===a._id?b(a,c,{x:e,y:f,z:g}):void 0}}function c(a,b,c,d){return null===d&&(d={}),function(e,f,g){return 1===g&&a._id===e&&b===f?c(a,d,{button:f}):void 0}}function d(a,b,c,d){return null===d&&(d={}),function(e,f,g){var h;return a._id===e&&b===f?(h=g-a._wheelPositions[b-1],a._wheelPositions[b-1]=g,c(a,d,{triggerWheel:b,position:g,difference:h})):void 0}}var e=this,f=[],g=null,h=null,i=null,j=[0,0,0];if(e._id=a,err=baroboBridge.connectRobot(a),err<0)return void(e._id=null);for(var k=1;3>=k;k++)baroboBridge.setMotorEventThreshold(e._id,k,1e10);if(e._wheelPositions=baroboBridge.getMotorAngles(e._id),e._firmwareVersion=baroboBridge.firmwareVersion(e._id),!baroboBridge.mock){var l=baroboBridge.availableFirmwareVersions();l.indexOf(e._firmwareVersion)<0&&(idAsURI=encodeURIComponent(e._id),baroboBridge.stop(e._id),document.location="../LinkbotUpdate/index.html?badRobot="+idAsURI)}this._wheelRadius=1.75,this.color=function(a,b,c){var d=0;for(baroboBridge.setLEDColor(e._id,a,b,c),d=0;d<f.length;d++)f[d](e._id,a,b,c)},this.getColor=function(){var a=null;return baroboBridge.getLEDColor&&(a=baroboBridge.getLEDColor(e._id)),a&&null!==a||(a={red:96,green:96,blue:96,mock:!0}),a.id=e._id,a},this.angularSpeed=function(a,b,c){return null===b&&(b=a),null===c&&(c=a),baroboBridge.angularSpeed(e._id,a,b,c)},this.move=function(a,b,c){return baroboBridge.move(e._id,a,b,c)},this.moveTo=function(a,b,c){return baroboBridge.moveTo(e._id,a,b,c)},this.moveForward=function(){j[0]=1,j[2]=-1,baroboBridge.moveContinuous(e._id,j[0],j[1],j[2])},this.moveBackward=function(){j[0]=-1,j[2]=1,baroboBridge.moveContinuous(e._id,j[0],j[1],j[2])},this.moveLeft=function(){j[0]=-1,j[2]=-1,baroboBridge.moveContinuous(e._id,j[0],j[1],j[2])},this.moveRight=function(){j[0]=1,j[2]=1,baroboBridge.moveContinuous(e._id,j[0],j[1],j[2])},this.moveJointContinuous=function(a,b){return a>=0&&2>=a?(j[a]=b>0?1:0>b?-1:0,baroboBridge.moveContinuous(e._id,j[0],j[1],j[2]),!0):!1},this.wheelPositions=function(){return e._wheelPositions=baroboBridge.getMotorAngles(e._id),e._wheelPositions},this.stop=function(){return j[0]=0,j[2]=0,baroboBridge.stop(e._id)},this.buzzerFrequency=function(a){return baroboBridge.buzzerFrequency(e._id,a)},this.disconnect=function(){return e.stop(),e._id=null,e._id},this.register=function(a){var j,k,l,m,n,o,p;if(a.button&&null!==a.button){n=a.button,null===h&&(h=[]);for(j in n)k=n[j],l=c(e,parseInt(j),k.callback,k.data),baroboBridge.buttonChanged.connect(l),h.push(l),baroboBridge.enableButtonSignals(e._id)}if(a.wheel&&null!==a.wheel){n=a.wheel,o=[],null===g&&(g=[]);for(p in n)k=n[p],m=parseInt(p),l=d(e,m,k.callback,k.data),baroboBridge.setMotorEventThreshold(e._id,m,k.distance),baroboBridge.motorChanged.connect(l),g.push(l),o.push(baroboBridge.enableMotorSignals(e._id))}return a.accel&&null!==a.accel&&(n=a.accel,i=b(e,n.callback,n.data),baroboBridge.accelChanged.connect(i),baroboBridge.enableAccelSignals(e._id)),a.led&&null!==a.led&&(n=a.led,f.push(n.callback)),o},this.unregister=function(a){try{if(g&&null!==g){baroboBridge.disableMotorSignals(e._id);for(var b in g)baroboBridge.motorChanged.disconnect(g[b]);g=null}}catch(c){console.log(c)}try{if(h&&null!==h){baroboBridge.disableButtonSignals(e._id);for(var d in h)baroboBridge.buttonChanged.disconnect(h[d]);h=null}}catch(c){console.log(c)}try{null!==i&&(baroboBridge.disableAccelSignals(e._id),baroboBridge.accelChanged.disconnect(i))}catch(c){console.log(c)}void 0===a||null===a?f=[]:a&&(f=[])}}function Storage(a){var b=a?a:{DBNAME:"robotsdb",DBVER:1,DBDESC:"Robots Database, used for persistance",TABLE:"robots"},c=null;try{c=openDatabase(b.DBNAME,b.DBVER,b.DBDESC,b.DBSIZE)}catch(d){return this.remove=function(){console.log("OpenDatabase not available")},this.add=function(){console.log("OpenDatabase not available")},this.getAll=function(){console.log("OpenDatabase not available")},this.updateOrder=function(){console.log("OpenDatabase not available")},this.printRows=function(){console.log("OpenDatabase not available")},void(this.changePosition=function(){console.log("OpenDatabase not available")})}c.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS "+b.TABLE+" (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT unique not null, status INTEGER not null, rorder INTEGER not null)",[],function(){},function(a,b){console.log(b)})}),this.remove=function(a,d){c.transaction(function(c){c.executeSql("DELETE FROM "+b.TABLE+" WHERE name = ?",[a],function(){d&&d(!0)},function(a,b){d&&d(!1,b)})})},this.add=function(a,d,e){c.transaction(function(c){c.executeSql("SELECT COUNT(*) AS c FROM "+b.TABLE,[],function(c,f){c.executeSql("INSERT INTO "+b.TABLE+" (name, status, rorder) values (?,?,?)",[a,d,f.rows.item(0).c],function(){e&&e(!0)},function(a,b){e&&e(!1,b)})},function(a,b){e&&e(!1,b)})})},this.getAll=function(a){c.transaction(function(c){c.executeSql("SELECT * FROM "+b.TABLE+" ORDER BY rorder",[],function(b,c){for(var d=c.rows,e=[],f=0;f<c.rows.length;f++)e.push({id:d.item(f).id,name:d.item(f).name,status:d.item(f).status,order:d.item(f).rorder});a&&a(e)},function(b,c){a&&a([],c)})})},this.updateOrder=function(a){c.transaction(function(c){c.executeSql("SELECT id FROM "+b.TABLE+" ORDER BY rorder",[],function(c,d){for(var e=function(){},f=function(){a&&a(!1,results)},g=0;g<d.rows.length;g++)c.executeSql("UPDATE "+b.TABLE+" SET rorder = ? WHERE id = ?",[g,d.rows.item(g).id],e,f);a&&a(!0)},function(){a&&a(!1,results)})})},this.printRows=function(){c.transaction(function(a){a.executeSql("SELECT * FROM "+b.TABLE+" ORDER BY rorder",[],function(a,b){for(var c=b.rows,d=0;d<b.rows.length;d++)console.log("ID:"+c.item(d).id+", NAME:"+c.item(d).name+", STATUS:"+c.item(d).status+", ORDER:"+c.item(d).rorder)},function(a,b){console.log(b)})})},this.changePosition=function(a,d,e){a!==d&&c.transaction(function(c){var f=a,g=d;a>d&&(f=d,g=a),c.executeSql("SELECT * from "+b.TABLE+" WHERE rorder BETWEEN ? and ? ORDER BY rorder",[f,g],function(c,f){var g=0,h=-1,i=f.rows;a>d&&(h=1);var j=function(a,b){e&&e(!0,b)},k=function(){e&&e(!1,results)};for(g=0;g<f.rows.length;g++){var l=i.item(g).rorder+h,m=i.item(g).id;i.item(g).rorder==a&&(l=d),c.executeSql("UPDATE "+b.TABLE+" SET rorder = ? WHERE id = ?",[l,m],j,k)}e&&e(!0)},function(a,b){e&&e(!1,b)})})}}baroboBridge=function(a){var b,c,d,e;if(a.baroboBridge&&null!==a.baroboBridge)return a.baroboBridge;methods=["angularSpeed","availableFirmwareVersions","buttonChanged","buzzerFrequency","connectRobot","disconnectRobot","enableButtonSignals","enableMotorSignals","enableAccelSignals","disableAccelSignals","disableButtonSignals","disableMotorSignals","firmwareVersion","getMotorAngles","moveTo","scan","setMotorEventThreshold","stop","moveContinuous"],signals=["accelChanged","motorChanged","buttonChanged"],obj={mock:!0};var f=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},g={},h=function(){};for(b=0,d=methods.length;d>b;b++)k=methods[b],obj[k]=h;for(c=0,e=signals.length;e>c;c++)k=signals[c],obj[k]={connect:h,disconnect:h};return obj.getLEDColor=function(a){return g[a]||(g[a]={red:f(0,255),green:f(0,255),blue:f(0,255)}),g[a]},obj.setLEDColor=function(a,b,c,d){g[a]={red:b,green:c,blue:d}},obj}(this);var LinkbotControls=function(a,b){"use strict";function c(){for(var a in g){var b=g[a];b.setDown(!1)}}function d(a){var b=a.clientX||a.pageX,c=a.clientY||a.pageY;for(var d in g){var e=g[d];e.isDown()&&e.updateXY(b,c)}}function e(a){function b(a){for(var b=0,c=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{x:b,y:c}}var c=a,d=a.parentElement,e=document.createElement("div"),f=document.createElement("img"),g=!1,h=180/Math.PI,i=0,j=0,k=[];return e.setAttribute("class","linkbotjs-knob-container"),d.replaceChild(e,c),c.setAttribute("value",i),f.setAttribute("width","100%"),f.draggable=!1,e.appendChild(f),e.appendChild(c),{getKnob:function(){return e},getKnobInput:function(){return c},getKnobImage:function(){return f},setDown:function(a){g=a},isDown:function(){return g},getPosition:function(){return b(e)},getCenter:function(){var a=b(e),c=[a.x,a.y,e.offsetWidth,e.offsetHeight],d={x:c[0]+c[2]/2,y:c[1]+c[3]/2};return d},updateXY:function(a,d){var g,l,m,n,o,p,q,r,s,t;for(r=i,n=b(e),o=[n.x,n.y,e.offsetWidth,e.offsetHeight],p={x:o[0]+o[2]/2,y:o[1]+o[3]/2},l=p.x-a,g=p.y-d,m=(Math.atan2(g,l)*h+270)%360,m=Math.round(m),r>=m?(t=r-m,s=360-r+m):(s=m-r,t=r+360-m),t>=s?j+=s:j-=t,f.style.transform="rotate("+m+"deg)",f.style.webkitTransform="rotate("+m+"deg)",c.value=m,i=m,q=0;q<k.length;q++)k[q](m)},setValue:function(a){var b,d;if(b=parseInt(a),isNaN(b))return void(c.value=i);for(j=b,b%=360;0>b;)b=360+b;for(f.style.transform="rotate("+b+"deg)",f.style.webkitTransform="rotate("+b+"deg)",i=b,c.value=i,d=0;d<k.length;d++)k[d](b)},setValueWithoutChange:function(a){var b;if(b=parseInt(a),isNaN(b))return void(c.value=i);for(j=b,b%=360;0>b;)b=360+b;f.style.transform="rotate("+b+"deg)",f.style.webkitTransform="rotate("+b+"deg)",i=b,c.value=i},getValue:function(){return i},getInternalValue:function(){return j},addChangeCallback:function(a){k.push(a)}}}var f=a.knob=a.knob||{},g=[],h={};return f.add=function(a){var c=null;if(c=a instanceof HTMLElement?a:b.getElementById(a),c&&null!==c){var d=new e(c);d.getKnob().addEventListener("mousedown",function(a){0===a.button&&d.setDown(!0)}),d.getKnob().addEventListener("click",function(a){var b=a.clientX||a.pageX,c=a.clientY||a.pageY;d.updateXY(b,c)}),d.getKnobInput().addEventListener("click",function(a){a.stopPropagation()},!0),d.getKnobInput().addEventListener("onchange",function(a){d.setValue(a.target.value)}),d.getKnobInput().addEventListener("keyup",function(a){d.setValue(a.target.value)}),d.getKnobInput().addEventListener("mousedown",function(a){a.stopPropagation()},!0),c.id&&(h[c.id]=d),g.push(d)}},f.init=function(){b.addEventListener("mouseup",c),b.addEventListener("mousemove",d);for(var a=document.getElementsByClassName("linkbotjs-knob"),e=0;e<a.length;e++)f.add(a[e])},f.get=function(a){return h[a]},f.getValue=function(a){var b=h[a];return b?b.getValue():null},f.getInternalValue=function(a){var b=h[a];return b?b.getInternalValue():void 0},f.addChangeCallback=function(a,b){var c=h[a];return c?c.addChangeCallback(b):void 0},a}(LinkbotControls||{},document),LinkbotControls=function(a,b){"use strict";function c(a){var b=a.clientX||a.pageX,c=a.clientY||a.pageY;for(var d in g){var e=g[d];if(e.isDown())return e.updateXY(b,c),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,!1}}function d(){for(var a in g){var b=g[a];b.setDown(!1)}}function e(a){function b(a){for(var b=0,c=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{x:b,y:c}}var c=0,d=0,e=100,f=!1,g=[],h="int";a.dataset.type&&(h=a.dataset.type),a.dataset.min&&(d=parseInt(a.dataset.min)),a.dataset.max&&(e=parseInt(a.dataset.max));var i=document.createElement("span"),j=!1;a.classList.contains("linkbotjs-vslider")?(j=!0,i.style.top="0",i.setAttribute("class","linkbotjs-vslider-handle")):(i.setAttribute("class","linkbotjs-slider-handle"),i.style.left="0");var k=a;return k.innerHTML="",k.appendChild(i),{getSlider:function(){return k
},getHandle:function(){return i},isVertical:function(){return j},isDown:function(){return f},setDown:function(a){f=a},updateXY:function(a,f){var l,m,n,o=b(k),p=[o.x,o.y,k.offsetWidth,k.offsetHeight];if(j)l=f-o.y,m=l/p[3],n=m*(e-d)+d,n>e?(c=e,i.style.top="100%"):d>n?(c=d,i.style.top="0%"):(i.style.top=100*m+"%",c="int"===h?Math.round(n):n);else if(l=a-o.x,m=l/p[2],n=m*(e-d)+d,n>e)c=e,i.style.left="100%";else{if(d>n)return c=d,void(i.style.left="0%");i.style.left=100*m+"%",c="int"===h?Math.round(n):n}for(var q in g)g[q](c)},setValue:function(a){var b=0;"int"===h?b=parseInt(a):"float"==h&&(b=parseFloat(a));var f;j?(f=(b-d)/(e-d),i.style.top=100*f+"%",c=b):(f=(b-d)/(e-d),i.style.left=100*f+"%",c=b);for(var k in g)g[k](c)},getValue:function(){return c},addChangeCallback:function(a){g.push(a)}}}a.slider=a.slider||{};var f=a.slider,g=[],h={};return f.add=function(a){var c=null;if(c=a instanceof HTMLElement?a:b.getElementById(a),c&&null!==c){var d=new e(c);d.getSlider().addEventListener("mousedown",function(a){0===a.button&&d.setDown(!0)}),d.getSlider().addEventListener("click",function(a){var b=a.clientX||a.pageX,c=a.clientY||a.pageY;d.updateXY(b,c)}),c.id&&(h[c.id]=d),g.push(d)}},f.init=function(){b.addEventListener("mouseup",d),b.addEventListener("mousemove",c);var a=document.getElementsByClassName("linkbotjs-vslider"),e=0;for(e=0;e<a.length;e++)f.add(a[e]);for(a=document.getElementsByClassName("linkbotjs-slider"),e=0;e<a.length;e++)f.add(a[e])},f.get=function(a){return h[a]},f.getValue=function(a){var b=h[a];return b?b.getValue():null},f.addChangeCallback=function(a,b){var c=h[a];return c?c.addChangeCallback(b):void 0},a}(LinkbotControls||{},document),Linkbots=function(a,b){function c(a,b){h.getAll(function(c){srcOrder=-1,destOrder=-1;for(var d=0;d<c.length&&(c[d].name===a?srcOrder=c[d].order:c[d].name===b&&(destOrder=c[d].order),!(destOrder>=0&&srcOrder>=0));d++);destOrder>=0&&srcOrder>=0&&h.changePosition(srcOrder,destOrder,function(a){if(a===!0){var b=g.robots.robots.splice(srcOrder,1);g.robots.robots.splice(destOrder,0,b[0])}})})}function d(a){h.add(a,0)}function e(a){h.remove(a,function(a){a&&h.updateOrder()})}function f(){g.element.style.top="75px",b.body.style.marginTop="90px",b.body.appendChild(g.topNav),b.body.appendChild(g.element)}var g=new RobotManager(b),h=new Storage;if(h.getAll(function(a){for(var b=0;b<a.length;b++)g.add(a[b].name);g.connect(),g.redraw()}),g.registerEvent("moved",c),g.registerEvent("add",d),g.registerEvent("remove",e),a.scan=function(){return baroboBridge.scan()},a.managerElement=function(){return console.log("this method is deprecated"),""},a.topNavElement=function(){return console.log("this method is deprecated"),""},a.acquire=function(a){return g.acquire(a)},a.relinquish=function(a){return g.relinquish(a)},a.managerAdd=function(){var a=1<=arguments.length?[].slice.call(arguments,0):[];return g.add.apply(g,a)},a.managerRedraw=function(){return g.redraw()},a.managerConnect=function(){return g.connect()},a.setNavTitle=function(a){var c=b.getElementById("ljs-top-nav-title");c&&(c.innerText=a)},a.setNavCrumbs=function(a){var c=b.getElementById("ljs-top-nav-breadcrumbs");c&&(c.innerText=a.join(" // "))},a.storage=h,LinkbotControls.knob.init(),LinkbotControls.slider.init(),window.attachEvent)window.attachEvent("onload",f);else if(window.onload){var i=window.onload,j=function(){i(),f()};window.onload=j}else window.onload=f;return a}(Linkbots||{},document);